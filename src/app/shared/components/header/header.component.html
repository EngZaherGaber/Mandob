<div class="header-container row w-full">
    <div class="col d-flex justify-content-start">
        <div class="row" style="align-items: center;">
            <div class="w-auto justify-content-start p-0 ">
                <p-button (onClick)="stateSrv.collapseSideNav()" [text]="true" styleClass="collapseButton"
                    [icon]="stateSrv.isOpenedSideNav() ? 'pi pi-angle-right' : 'pi pi-angle-left'" severity="primary" />
            </div>
            <div class="col  d-flex align-items-center p-0 ">
                <ng-container *ngIf="isBrowser; then browserView; else serverView"></ng-container>

                <!-- Client-side template with animations -->
                <ng-template #browserView>
                    <div @fade *ngIf="!isChanging()"
                        class="typewriter-container border-start border-2 border-secondary ps-4">
                        <p class="typewriter-text fw-bold">
                            {{displayText()}}
                            <span class="cursor" *ngIf="isTyping()">|</span>
                        </p>
                    </div>
                </ng-template>

                <!-- Server-side template (static) -->
                <ng-template #serverView>
                    <p>{{currentState()}}</p>
                </ng-template>
            </div>
        </div>
    </div>
    <div class="col" style="position: relative;z-index: 999;" *ngIf="user?.role === 'client'">
        <p-iconfield>
            <p-inputicon class="pi" [ngClass]="!searchLoading ? ['pi-search'] : ['pi-spinner','pi-spin']" />
            <input type="text" #search (input)="changeSearchInput(search.value)" [value]="stateSrv.searchInput()"
                pInputText placeholder="Search" />
        </p-iconfield>
    </div>
    <div class="col d-flex position-relative justify-content-end align-items-center gap-2" style="z-index: 1;">
        <p-button (onClick)="stateSrv.setIsDark(!stateSrv.isDark())"
            [icon]="stateSrv.isDark() ? 'pi pi-sun' : 'pi pi-moon'" [rounded]="true" [text]="true" severity="primary"
            [pTooltip]="stateSrv.isDark() ? 'الوضع النهاري' : 'الوضع الليلي'" />
        <p-button icon="pi pi-bell" [rounded]="true" [text]="true" severity="primary" pTooltip="الاشعارات" />
        <p-button *ngIf="user?.role !== 'owner'" icon="pi pi-truck" (onClick)="stateSrv.collapseCart()" [rounded]="true"
            [text]="true" severity="primary" pTooltip="الشاحنة" />
        <a (click)="menu.toggle($event)" style="cursor: pointer;">
            <p-avatar *ngIf="user && user.logo" [image]="user.logo" shape="circle" />
            <p-avatar *ngIf="!(user && user.logo)" icon="pi pi-user" shape="circle" />
        </a>
        <p-menu #menu [model]="items" [popup]="true">
            <ng-template #start>
                <div class="d-flex flex-column align-items-end p-2"
                    style="background-color: var(--p-primary-500);color: var(--p-text-hover-color);">
                    <div class="d-flex justify-content-between align-items-center w-100">
                        <div class="d-flex flex-column align-items-center w-100">
                            <p class="fw-bold">{{user?.name}}</p>
                            <span class="fw-bold">{{user?.role}}</span>
                        </div>
                        <div class="rounded-4 d-flex justify-content-center" style="width: 50px;height: 50px;">

                            <p-avatar *ngIf="user && user.logo" [image]="user.logo" shape="circle" />
                            <p-avatar *ngIf="!(user && user.logo)" icon="pi pi-user" shape="circle" />
                        </div>
                    </div>
                </div>
            </ng-template>
        </p-menu>


    </div>
</div>
<div *ngIf="stateSrv.isOpenSearchMenu()" (ClickOutside)="onClickOutside($event)" class="position-absolute search-menu ">
    <client-tool-search-menu [result]="searchResult" [header]="stateSrv.searchInput()"
        (closeMenu)="onClickOutside($event)" />

</div>

<p-dialog (visibleChange)="closeDialog($event,changePasswordForm)" header="تغيير كلمة السر" [modal]="true"
    *ngIf="changePasswordvisible" [(visible)]="changePasswordvisible" [style]="{ width: '25rem' }">
    <dynmaic-form class="dyn-frm" [scrollHeight]="'25vh'" (submit)="changePassword($event)" [display]="'flex'"
        [withBackBtn]="false" [objs]="changePasswordForm" style="width: 100%;" [justOneStep]="true"></dynmaic-form>
</p-dialog>
<p-dialog header="تغيير رقم الهاتف" [modal]="true" *ngIf="changePhoneNumbervisible"
    (visibleChange)="closeDialog($event,changePhoneNumberForm)" [(visible)]="changePhoneNumbervisible"
    [style]="{ width: '25rem' }">
    <dynmaic-form class="dyn-frm" [scrollHeight]="'25vh'" (submit)="verifyChangePhoneNumber($event)" [display]="'flex'"
        [withBackBtn]="false" [stepsList]="stepsPhoneNumberList" [objs]="changePhoneNumberForm" style="width: 100%;"
        [showSteps]="true" (onActiveIndexChange)="changePhoneNumber($event)"></dynmaic-form>
</p-dialog>